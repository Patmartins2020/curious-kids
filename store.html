<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Curious Kids ‚Äì Store</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#16a34a" />

    <!-- PWA manifest + icons (same paths you already use) -->
    <link rel="manifest" href="manifest.webmanifest" />
    <link rel="icon" type="image/png" href="icons/favicon.png" />
    <link rel="apple-touch-icon" href="icons/icon-192.png" />

    <style>
      :root {
        --primary: #ff8a3d;
        --primary-dark: #e46f22;
        --secondary: #4d8fff;
        --card-bg: #ffffff;
        --bg: #f7fbff;
        --text: #0f172a;
        --muted: #6b7280;
        --shadow-soft: 0 10px 25px rgba(15, 23, 42, 0.08);
        --radius-lg: 18px;
        --radius-sm: 10px;
        --font-main: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: var(--font-main);
        background: radial-gradient(
          circle at top,
          #e0f2ff 0,
          #f7fbff 45%,
          #ffffff 100%
        );
        color: var(--text);
        min-height: 100vh;
      }

      a {
        text-decoration: none;
        color: inherit;
      }

      /* HEADER + NAVBAR (same behaviour as other pages) */

      header {
        position: sticky;
        top: 0;
        z-index: 50;
        background: #16a34a;
        color: #f9fafb;
        border-bottom: 1px solid rgba(15, 23, 42, 0.15);
        box-shadow: 0 10px 25px rgba(15, 23, 42, 0.18);
      }

      .nav-inner {
        max-width: 1100px;
        margin: 0 auto;
        padding: 0.6rem 1rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 0.6rem;
      }

      .brand-logo {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: conic-gradient(
          from 180deg,
          #ff8a3d,
          #ffd74d,
          #4d8fff,
          #16a34a,
          #ff8a3d
        );
        display: flex;
        align-items: center;
        justify-content: center;
        color: #ffffff;
        font-weight: 800;
        font-size: 1.1rem;
        cursor: pointer; /* admin unlock */
        box-shadow: 0 4px 14px rgba(15, 23, 42, 0.35);
      }

      .brand-text {
        display: flex;
        flex-direction: column;
        line-height: 1.1;
      }

      .brand-text span:first-child {
        font-weight: 800;
        font-size: 1rem;
        letter-spacing: 0.03em;
      }

      .brand-text span:last-child {
        font-size: 0.75rem;
        color: rgba(226, 232, 240, 0.9);
      }

      nav ul {
        list-style: none;
        display: flex;
        gap: 0.75rem;
        font-size: 0.9rem;
        align-items: center;
      }

      nav a {
        padding: 0.35rem 0.8rem;
        border-radius: 999px;
        color: #e5e7eb;
        font-weight: 500;
        transition: background 0.15s, color 0.15s, transform 0.1s;
      }

      nav a:hover {
        background: rgba(255, 255, 255, 0.16);
        color: #ffffff;
        transform: translateY(-1px);
      }

      .nav-cta {
        background: #ffffff;
        color: #0f172a;
        box-shadow: 0 3px 10px rgba(15, 23, 42, 0.35);
      }

      .nav-cart {
        position: relative;
      }

      .nav-cart-count {
        position: absolute;
        top: -4px;
        right: -6px;
        background: #e11d48;
        color: #fff;
        font-size: 0.6rem;
        border-radius: 999px;
        padding: 0 0.25rem;
        min-width: 14px;
        text-align: center;
      }

      /* Hamburger button */

      .nav-toggle {
        display: none;
        border: none;
        background: transparent;
        cursor: pointer;
        padding: 0.25rem;
      }

      .nav-toggle span {
        display: block;
        width: 22px;
        height: 2px;
        background: #ffffff;
        margin: 4px 0;
        border-radius: 999px;
      }

      /* MAIN LAYOUT */

      main {
        max-width: 1100px;
        margin: 0 auto;
        padding: 1.5rem 1rem 2.5rem;
      }

      .section-header {
        margin-bottom: 0.9rem;
      }

      .section-header h1 {
        font-size: 1.5rem;
        margin-bottom: 0.25rem;
      }

      .section-header p {
        font-size: 0.9rem;
        color: var(--muted);
      }

      .card {
        background: var(--card-bg);
        border-radius: var(--radius-lg);
        padding: 1.1rem 1rem;
        box-shadow: var(--shadow-soft);
        border: 1px solid rgba(148, 163, 184, 0.18);
      }

      .store-layout {
        display: grid;
        grid-template-columns: minmax(0, 3fr) minmax(0, 2fr);
        gap: 1.3rem;
        align-items: flex-start;
      }

      .currency-row {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 0.4rem;
        font-size: 0.78rem;
        color: #4b5563;
        margin-bottom: 0.4rem;
      }

      select {
        font-size: 0.8rem;
        padding: 0.25rem 0.4rem;
        border-radius: 999px;
        border: 1px solid #cbd5f5;
        background: #f9fbff;
        outline: none;
      }

      .store-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 0.9rem;
      }

      .product-card {
        background: #fff;
        border-radius: var(--radius-lg);
        border: 1px solid rgba(148, 163, 184, 0.25);
        padding: 0.7rem 0.75rem 0.8rem;
        box-shadow: 0 4px 12px rgba(15, 23, 42, 0.04);
        display: flex;
        flex-direction: column;
        gap: 0.3rem;
        font-size: 0.85rem;
      }

      .product-type {
        font-size: 0.7rem;
        color: #6b7280;
      }

      .product-name {
        font-weight: 600;
      }

      .product-tag {
        font-size: 0.75rem;
        color: #6b7280;
      }

      .product-price {
        font-size: 0.9rem;
        font-weight: 700;
        color: #16a34a;
      }

      .btn {
        border-radius: 999px;
        padding: 0.5rem 1rem;
        border: none;
        cursor: pointer;
        font-weight: 600;
        font-size: 0.85rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.4rem;
      }

      .btn-primary {
        background: var(--primary);
        color: #fff;
        box-shadow: 0 5px 16px rgba(248, 113, 22, 0.5);
      }

      .btn-primary:hover {
        background: var(--primary-dark);
      }

      .btn-ghost {
        background: #f9fafb;
        color: #1f2937;
        border: 1px solid rgba(148, 163, 184, 0.6);
      }

      .store-cart-items {
        margin-top: 0.6rem;
        max-height: 240px;
        overflow-y: auto;
        font-size: 0.8rem;
      }

      .cart-item-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.25rem;
      }

      .cart-total {
        margin-top: 0.6rem;
        font-weight: 700;
      }

      .cart-actions {
        display: flex;
        flex-direction: column;
        gap: 0.4rem;
        margin-top: 0.8rem;
      }

      /* ADMIN SECTION */

      #adminSection {
        display: none;
        margin-top: 1.8rem;
      }

      .admin-grid {
        display: grid;
        grid-template-columns: minmax(0, 1.5fr) minmax(0, 1.5fr);
        gap: 1.3rem;
        align-items: flex-start;
      }

      .admin-field {
        margin-bottom: 0.7rem;
        font-size: 0.85rem;
      }

      .admin-field input,
      .admin-field select {
        width: 100%;
        margin-top: 0.25rem;
        padding: 0.35rem 0.45rem;
        border-radius: 8px;
        border: 1px solid rgba(148, 163, 184, 0.8);
        font-size: 0.85rem;
      }

      .admin-tag-group {
        display: flex;
        flex-wrap: wrap;
        gap: 0.25rem;
        margin-top: 0.35rem;
      }

      .admin-tag-pill {
        font-size: 0.7rem;
        padding: 0.15rem 0.45rem;
        border-radius: 999px;
        background: rgba(148, 163, 184, 0.18);
        cursor: pointer;
      }

      .message-success {
        color: #16a34a;
        font-size: 0.78rem;
        margin-top: 0.3rem;
      }

      .message-error {
        color: #e11d48;
        font-size: 0.78rem;
        margin-top: 0.3rem;
      }

      .empty-state {
        font-size: 0.85rem;
        color: var(--muted);
        background: #eff6ff;
        border-radius: var(--radius-lg);
        padding: 0.9rem 0.8rem;
        border: 1px dashed rgba(129, 140, 248, 0.7);
      }

      footer {
        margin-top: 2.8rem;
        padding: 1.2rem 1rem 1.8rem;
        font-size: 0.75rem;
        color: var(--muted);
        border-top: 1px solid rgba(148, 163, 184, 0.25);
        text-align: center;
      }

      /* RESPONSIVE LAYOUTS */

      @media (max-width: 900px) {
        .store-layout,
        .admin-grid {
          grid-template-columns: minmax(0, 1fr);
        }
      }

      @media (max-width: 800px) {
        .nav-toggle {
          display: inline-flex;
        }

        nav {
          position: relative;
        }

        nav ul {
          position: absolute;
          top: 44px;
          right: 0.6rem;
          flex-direction: column;
          align-items: flex-end;
          background: rgba(15, 23, 42, 0.98);
          padding: 0.6rem 0.9rem;
          border-radius: 12px;
          box-shadow: 0 10px 25px rgba(15, 23, 42, 0.4);
          display: none; /* hidden by default */
        }

        nav ul.open {
          display: flex; /* show when toggled */
        }

        nav a {
          display: block;
          width: 100%;
          text-align: right;
        }
      }
      /* ---------- Uncle Pat Widget ---------- */

/* ---------- Uncle Pat Widget ---------- */

.uncle-pat-widget {
  position: fixed;
  bottom: 16px;
  right: 16px;
  z-index: 9999;
  pointer-events: auto;
}

.uncle-pat-bear {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
}

.uncle-pat-avatar {
  width: 52px;
  height: 52px;
  border-radius: 50%;
  overflow: hidden;
  padding: 0;
  background: none;
  box-shadow: 0 4px 10px rgba(0,0,0,0.25);
}

.uncle-pat-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Flag bubble */
.uncle-pat-flag {
  background: #ffffff;
  color: #047857;
  padding: 8px 12px;
  border-radius: 999px;
  font-size: 0.75rem;
  box-shadow: 0 4px 12px rgba(15, 23, 42, 0.18);
  border: 1px solid #d1fae5;
  white-space: nowrap;
  position: relative;
}

.uncle-pat-flag::before {
  content: "";
  position: absolute;
  width: 0;
  height: 0;
  border-top: 6px solid transparent;
  border-bottom: 6px solid transparent;
  border-right: 8px solid #ffffff;
  left: -8px;
  top: 50%;
  transform: translateY(-50%);
}

/* ---------- Full Bear ---------- */

.uncle-pat-full {
  position: fixed;
  bottom: 100px;
  right: 200px;   /* keeps bear beside the panel */
  width: 120px;   /* smaller default size */
  max-width: 25vw;
  opacity: 0;
  transform: scale(0.1);
  pointer-events: none;
  transition: opacity 0.35s ease, transform 0.35s ease;
  z-index: 9998;
}

.uncle-pat-full img {
  width: 100%;
  height: auto;
}

.uncle-pat-full.show {
  opacity: 1;
  transform: scale(1);
}

/* Mobile positioning */
@media (max-width: 480px) {
  .uncle-pat-full {
    right: 140px;
    bottom: 90px;
    width: 95px;
  }
}
/* ---------- Uncle Pat Panel ---------- */

.uncle-pat-panel {
  position: fixed;
  right: 16px;
  bottom: 88px;
  width: 320px;
  max-width: calc(100% - 32px);
  background: rgba(15, 23, 42, 0.6);
  border-radius: 16px;
  padding: 4px;
  z-index: 9997;
  display: none;
}

.uncle-pat-panel.open {
  display: block;
}

.uncle-pat-panel-inner {
  background: #f9fafb;
  border-radius: 12px;
  padding: 12px 14px;
  box-shadow: 0 10px 25px rgba(15,23,42,0.4);
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
}

.uncle-pat-panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: 700;
  font-size: 0.95rem;
  color: #0f172a;
  margin-bottom: 4px;
}

.uncle-pat-panel-sub {
  font-size: 0.78rem;
  color: #4b5563;
  margin-bottom: 8px;
}

.uncle-pat-panel-close {
  background: none;
  border: none;
  font-size: 1.1rem;
  cursor: pointer;
  color: #6b7280;
}

.uncle-pat-label {
  display: block;
  font-size: 0.78rem;
  color: #374151;
  margin-bottom: 6px;
}

.uncle-pat-label select,
.uncle-pat-label textarea {
  width: 100%;
  margin-top: 2px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  padding: 6px 8px;
  font-size: 0.78rem;
  resize: vertical;
  font-family: inherit;
}

.uncle-pat-ask-btn {
  width: 100%;
  margin-top: 6px;
  background: #10b981;
  color: #ffffff;
  border: none;
  border-radius: 999px;
  padding: 8px 10px;
  font-size: 0.82rem;
  font-weight: 600;
  cursor: pointer;
}

.uncle-pat-ask-btn:hover {
  background: #059669;
}

.uncle-pat-answer {
  margin-top: 8px;
  padding: 8px;
  background: #ecfdf5;
  border-radius: 8px;
  font-size: 0.78rem;
  color: #064e3b;
  max-height: 180px;
  overflow-y: auto;
}
    </style>
  </head>

  <body>
    <!-- HEADER -->
    <header>
      <div class="nav-inner">
        <div class="brand">
          <!-- Logo click unlocks admin panel -->
          <div class="brand-logo" onclick="handleAdminLogoClick()">CK</div>
          <div class="brand-text">
            <span>Curious Kids Q&A</span>
            <span>Ask big questions. Get gentle answers.</span>
          </div>
        </div>

        <!-- Mobile hamburger -->
        <button
          class="nav-toggle"
          id="navToggle"
          aria-label="Toggle navigation menu"
        >
          <span></span>
          <span></span>
          <span></span>
        </button>

        <nav>
          <ul id="navLinks">
            <li><a href="index.html">Home</a></li>
            <li><a href="ask.html">Ask a Question</a></li>
            <li><a href="questions.html">Question Wall</a></li>
            <li><a href="store.html">Store</a></li>
            <li><a href="parents.html">For Parents</a></li>
            <li><a href="forum.html">Adult Forum</a></li>
            <li><a href="legal.html">Legal</a></li>
            <li><a href="ask.html" class="nav-cta">Ask Now</a></li>
            <li>
              <a href="store.html" class="nav-cart">
                üõí Cart
                <span
                  id="navCartCount"
                  class="nav-cart-count"
                  style="display: none"
                  >0</span
                >
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <!-- MAIN -->
    <main>
      <section class="section-header">
        <h1>Curious Kids Store</h1>
        <p>
          Kid-friendly colouring books, Bible story printables, shirts and more.
          Prices are shown in <strong>US Dollars</strong> by default with a
          toggle for other currencies.
        </p>
      </section>

      <section class="card store-layout">
        <!-- LEFT: STORE PRODUCTS -->
        <div>
          <div class="currency-row">
            <span>Currency:</span>
            <select id="currencySelect" onchange="setCurrency(this.value)">
              <option value="USD" selected>USD ($)</option>
              <option value="EUR">EUR (‚Ç¨)</option>
              <option value="GBP">GBP (¬£)</option>
              <option value="NGN">NGN (‚Ç¶)</option>
            </select>
          </div>
          <h3 style="font-size: 1rem; margin-bottom: 0.4rem">
            Browse Products
          </h3>
          <div id="storeGrid" class="store-grid"></div>
        </div>

        <!-- RIGHT: CART -->
        <div class="card">
          <h3 style="font-size: 1rem">Your Cart</h3>
          <p class="hint" style="font-size: 0.75rem; color: #6b7280">
            Cart is local to this device. Later you can connect this page to
            Paystack, Flutterwave, Stripe or other gateways.
          </p>

          <div id="cartItems" class="store-cart-items"></div>
          <div id="cartTotal" class="cart-total">Total: $0.00</div>

          <div class="cart-actions">
            <button
              class="btn btn-primary"
              type="button"
              onclick="goToPayment()"
            >
              ‚úÖ Proceed to Payment
            </button>
            <button class="btn btn-ghost" type="button" onclick="clearCart()">
              üßπ Clear Cart
            </button>
          </div>
        </div>
      </section>

      <!-- ADMIN SECTION: hidden until admin unlock -->
      <section id="adminSection" class="card">
        <div class="section-header" style="margin-bottom: 0.6rem">
          <h2 style="font-size: 1.1rem">
            Admin Panel ‚Äì Store & Private Questions
          </h2>
          <p style="font-size: 0.8rem">
            Enter your admin code via the CK logo to open this panel. This
            section is for the owner only and does not appear to regular
            visitors.
          </p>
        </div>

        <div class="admin-grid">
          <!-- LEFT: PRODUCT ADMIN -->
          <div>
            <h3 style="font-size: 1rem; margin-bottom: 0.4rem">
              Add / Update Product
            </h3>

            <div class="admin-field">
              <label for="adminName">Product Name</label>
              <input
                id="adminName"
                placeholder="e.g. Noah‚Äôs Ark Coloring Book"
              />
            </div>

            <div class="admin-field">
              <label for="adminPrice">Price in USD (e.g. 5)</label>
              <input id="adminPrice" placeholder="e.g. 5" />
            </div>

            <div class="admin-field">
              <label for="adminType">Type</label>
              <select id="adminType">
                <option value="Digital Download">Digital Download (PDF)</option>
                <option value="Physical Item">
                  Physical Item (Shirt, Mug, etc.)
                </option>
              </select>
            </div>

            <div class="admin-field">
              <label for="adminTagline">Short Tagline</label>
              <input
                id="adminTagline"
                placeholder="e.g. Bible story colouring fun"
              />
            </div>

            <div class="admin-field">
              <label for="adminCategory">Category / Label</label>
              <input
                id="adminCategory"
                placeholder="e.g. Colouring Book, Shirt, Stickers"
              />
              <div class="admin-tag-group">
                <span
                  class="admin-tag-pill"
                  onclick="quickFillCategory('Colouring Book')"
                  >Colouring Book</span
                >
                <span
                  class="admin-tag-pill"
                  onclick="quickFillCategory('Bible Story')"
                  >Bible Story</span
                >
                <span
                  class="admin-tag-pill"
                  onclick="quickFillCategory('Kids Shirt')"
                  >Kids Shirt</span
                >
                <span
                  class="admin-tag-pill"
                  onclick="quickFillCategory('Stickers')"
                  >Stickers</span
                >
                <span class="admin-tag-pill" onclick="quickFillCategory('Mug')"
                  >Mug</span
                >
              </div>
            </div>

            <div class="admin-field">
              <label for="adminImage">Image URL (optional)</label>
              <input
                id="adminImage"
                placeholder="CDN/hosted image URL or leave blank"
              />
            </div>

            <button
              type="button"
              class="btn btn-primary"
              onclick="addProductFromAdmin()"
            >
              üíæ Save Product
            </button>
            <div id="adminMessage"></div>
          </div>

          <!-- RIGHT: PREVIEW + PRIVATE QUESTIONS -->
          <div>
            <h3 style="font-size: 1rem; margin-bottom: 0.4rem">
              Current Products (Preview)
            </h3>
            <div id="adminProductList" class="store-grid"></div>

            <div style="margin-top: 1rem">
              <h3 style="font-size: 1rem; margin-bottom: 0.3rem">
                Private & Consultation Questions
              </h3>
              <p
                class="hint"
                style="
                  font-size: 0.75rem;
                  color: #6b7280;
                  margin-bottom: 0.3rem;
                "
              >
                These questions are marked private/consultation and never appear
                on the public Question Wall.
              </p>
              <div id="privateQuestionsList" class="store-cart-items"></div>
              <button
                class="btn btn-ghost"
                type="button"
                onclick="clearPrivateQuestions()"
                style="font-size: 0.75rem; margin-top: 0.4rem"
              >
                üßπ Clear Private Questions
              </button>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <p>
        ¬© <span id="year"></span> Curious Kids Q&A. Kid-friendly questions and
        answers.
      </p>
    </footer>

    <!-- SCRIPT -->
    <script>
      // ---------------------------
      // NAVBAR TOGGLE (mobile)
      // ---------------------------
      (function () {
        const toggle = document.getElementById("navToggle");
        const links = document.getElementById("navLinks");
        if (!toggle || !links) return;

        toggle.addEventListener("click", () => {
          links.classList.toggle("open");
        });

        links.addEventListener("click", (event) => {
          if (event.target.tagName.toLowerCase() === "a") {
            links.classList.remove("open");
          }
        });
      })();

      // ---------------------------
      // CONSTANTS / KEYS
      // ---------------------------
      const STORE_KEY = "curiousKidsStoreProducts";
      const CART_KEY = "curiousKidsCart";
      const QUESTIONS_KEY = "curiousKidsQuestions";
      const ADMIN_CODE = "CKAdmin2025";

      let currency = "USD";
      const currencyData = {
        USD: { symbol: "$", rate: 1 },
        EUR: { symbol: "‚Ç¨", rate: 0.9 },
        GBP: { symbol: "¬£", rate: 0.8 },
        NGN: { symbol: "‚Ç¶", rate: 1500 },
      };

      const yearEl = document.getElementById("year");
      if (yearEl) yearEl.textContent = new Date().getFullYear();

      function escapeHtml(str) {
        if (!str) return "";
        return String(str).replace(
          /[&<>\"']/g,
          (ch) =>
            ({
              "&": "&amp;",
              "<": "&lt;",
              ">": "&gt;",
              '"': "&quot;",
              "'": "&#39;",
            }[ch] || ch)
        );
      }

      // ---------------------------
      // STORE PRODUCTS
      // ---------------------------
      function loadStoreProducts() {
        try {
          const raw = localStorage.getItem(STORE_KEY);
          if (!raw) return null;
          const parsed = JSON.parse(raw);
          return Array.isArray(parsed) ? parsed : null;
        } catch {
          return null;
        }
      }

      function saveStoreProducts(list) {
        try {
          localStorage.setItem(STORE_KEY, JSON.stringify(list));
        } catch {}
      }

      function defaultProducts() {
        return [
          {
            id: 1,
            name: "Curious Kids Bible Colouring Book",
            priceUSD: 5,
            type: "Digital Download",
            tagline: "Print-at-home colouring fun.",
            category: "Colouring Book",
          },
          {
            id: 2,
            name: "Noah‚Äôs Ark Story Colouring Pack",
            priceUSD: 4,
            type: "Digital Download",
            tagline: "Animals, rainbows and the ark.",
            category: "Bible Story",
          },
          {
            id: 3,
            name: "Curious Kids Logo T-Shirt",
            priceUSD: 12,
            type: "Physical Item",
            tagline: "Bright, fun and kid-friendly.",
            category: "Kids Shirt",
          },
          {
            id: 4,
            name: "Sticker Sheet ‚Äì Faith & Fun",
            priceUSD: 3,
            type: "Physical Item",
            tagline: "Reward stickers for kids.",
            category: "Stickers",
          },
        ];
      }

      function getProducts() {
        let stored = loadStoreProducts();
        if (!stored) {
          stored = defaultProducts();
          saveStoreProducts(stored);
        } else {
          stored = stored.map((p) =>
            p.priceUSD == null && p.price != null
              ? { ...p, priceUSD: p.price }
              : p
          );
        }
        return stored;
      }

      function formatPrice(usd) {
        const c = currencyData[currency] || currencyData.USD;
        const v = usd * c.rate;
        if (["USD", "EUR", "GBP"].includes(currency)) {
          return c.symbol + v.toFixed(2);
        }
        return c.symbol + Math.round(v);
      }

      function setCurrency(code) {
        currency = code || "USD";
        renderStore();
        renderCart();
      }

      function renderStore() {
        const grid = document.getElementById("storeGrid");
        const adminList = document.getElementById("adminProductList");
        const products = getProducts();
        if (!grid) return;

        const cardHtml = products
          .map(
            (p) => `
        <article class="product-card">
          <div class="product-type">${escapeHtml(p.type || "Item")}</div>
          <div class="product-name">${escapeHtml(p.name)}</div>
          <div class="product-tag">${escapeHtml(p.tagline || "")}</div>
          <div class="product-tag" style="font-size:.7rem;opacity:.8;">
            ${escapeHtml(p.category || "")}
          </div>
          <div class="product-price">
            ${formatPrice(Number(p.priceUSD || 0))}
          </div>
          <button
            class="btn btn-primary"
            type="button"
            onclick="addToCart('${escapeHtml(
              p.name
            ).replace(/'/g, "\\'")}', ${Number(p.priceUSD || 0)})"
          >
            ‚ûï Add to Cart
          </button>
        </article>`
          )
          .join("");

        grid.innerHTML = cardHtml;

        if (adminList) {
          adminList.innerHTML = cardHtml;
        }
      }

      // ---------------------------
      // CART
      // ---------------------------
      function loadCart() {
        try {
          const raw = localStorage.getItem(CART_KEY);
          if (!raw) return [];
          const parsed = JSON.parse(raw);
          return Array.isArray(parsed) ? parsed : [];
        } catch {
          return [];
        }
      }

      function saveCart(cart) {
        try {
          localStorage.setItem(CART_KEY, JSON.stringify(cart));
        } catch {
          console.warn("Could not save cart.");
        }
      }

      function addToCart(name, priceUSD) {
        const cart = loadCart();
        const existing = cart.find((item) => item.name === name);

        if (existing) {
          existing.quantity = (existing.quantity || 1) + 1;
        } else {
          cart.push({
            name,
            price: Number(priceUSD) || 0,
            quantity: 1,
          });
        }

        saveCart(cart);
        renderCart();
        alert("Added to cart: " + name);
      }

      function clearCart() {
        saveCart([]);
        renderCart();
      }

      function renderCart() {
        const items = loadCart();
        const listEl = document.getElementById("cartItems");
        const totalEl = document.getElementById("cartTotal");
        const navCountEl = document.getElementById("navCartCount");

        if (!listEl || !totalEl) return;

        if (!items.length) {
          listEl.innerHTML =
            '<div class="empty-state">Your cart is empty.</div>';
          totalEl.textContent = "Total: $0.00";
          if (navCountEl) navCountEl.style.display = "none";
          return;
        }

        let totalUSD = 0;
        const rows = items
          .map((item) => {
            const lineTotal = (item.price || 0) * (item.quantity || 1);
            totalUSD += lineTotal;
            return `
          <div class="cart-item-row">
            <span>${escapeHtml(item.name)} x ${item.quantity || 1}</span>
            <span>${formatPrice(lineTotal)}</span>
          </div>`;
          })
          .join("");

        listEl.innerHTML = rows;
        totalEl.textContent = "Total: " + formatPrice(totalUSD);

        const count = items.reduce(
          (sum, item) => sum + (item.quantity || 1),
          0
        );
        if (navCountEl) {
          navCountEl.textContent = count;
          navCountEl.style.display = count ? "inline-block" : "none";
        }
      }

      function goToPayment() {
        const items = loadCart();
        if (!items.length) {
          alert("Your cart is empty. Please add at least one item.");
          return;
        }
        // Payment page will re-read cart from localStorage
        window.location.href = "payment.html";
      }

      // ---------------------------
      // ADMIN HELPERS
      // ---------------------------
      function handleAdminLogoClick() {
        const code = prompt("Admin access code:");
        if (code === ADMIN_CODE) {
          const section = document.getElementById("adminSection");
          if (section) section.style.display = "block";
        } else if (code) {
          alert("Incorrect code.");
        }
      }

      function quickFillCategory(label) {
        const field = document.getElementById("adminCategory");
        if (!field) return;
        field.value = label;
      }

      function addProductFromAdmin() {
        const name = document.getElementById("adminName").value.trim();
        const priceStr = document.getElementById("adminPrice").value.trim();
        const type = document.getElementById("adminType").value;
        const tagline = document.getElementById("adminTagline").value.trim();
        const category = document.getElementById("adminCategory").value.trim();
        const imageUrl = document.getElementById("adminImage").value.trim();
        const msgEl = document.getElementById("adminMessage");

        if (!name || !priceStr) {
          if (msgEl) {
            msgEl.textContent = "Name and price are required.";
            msgEl.className = "message-error";
          }
          return;
        }

        const priceUSD = Number(priceStr);
        if (Number.isNaN(priceUSD) || priceUSD <= 0) {
          if (msgEl) {
            msgEl.textContent = "Enter a valid positive price in USD.";
            msgEl.className = "message-error";
          }
          return;
        }

        const products = getProducts();
        const existing = products.find(
          (p) => p.name.toLowerCase() === name.toLowerCase()
        );

        if (existing) {
          existing.priceUSD = priceUSD;
          existing.type = type;
          existing.tagline = tagline;
          existing.category = category;
          existing.imageUrl = imageUrl;
        } else {
          const nextId =
            products.reduce((max, p) => Math.max(max, p.id || 0), 0) + 1;
          products.push({
            id: nextId,
            name,
            priceUSD,
            type,
            tagline,
            category,
            imageUrl,
          });
        }

        saveStoreProducts(products);
        renderStore();

        if (msgEl) {
          msgEl.textContent = "Product saved successfully.";
          msgEl.className = "message-success";
        }
      }

      function loadPrivateQuestions() {
        try {
          const raw = localStorage.getItem(QUESTIONS_KEY);
          if (!raw) return [];
          const parsed = JSON.parse(raw);
          if (!Array.isArray(parsed)) return [];
          return parsed.filter((q) => q.isPrivate || q.isConsult);
        } catch {
          return [];
        }
      }

      function clearPrivateQuestions() {
        if (!confirm("Clear all private/consultation questions on this device?"))
          return;
        try {
          const raw = localStorage.getItem(QUESTIONS_KEY);
          if (!raw) return;
          const parsed = JSON.parse(raw);
          if (!Array.isArray(parsed)) return;
          const remaining = parsed.filter(
            (q) => !q.isPrivate && !q.isConsult
          );
          localStorage.setItem(QUESTIONS_KEY, JSON.stringify(remaining));
        } catch {}
        renderPrivateQuestions();
      }

      function renderPrivateQuestions() {
        const listEl = document.getElementById("privateQuestionsList");
        if (!listEl) return;
        const items = loadPrivateQuestions();
        if (!items.length) {
          listEl.innerHTML =
            '<div class="empty-state">No private or consultation questions stored on this device.</div>';
          return;
        }

        listEl.innerHTML = items
          .map(
            (q) => `
          <div style="border-bottom:1px solid rgba(148,163,184,0.3);padding:0.4rem 0;">
            <div style="font-size:.8rem;color:#6b7280;margin-bottom:.15rem;">
              ${escapeHtml(q.childName || "Child")} ¬∑ ${escapeHtml(
              q.country || ""
            )}
            </div>
            <div style="font-size:.85rem;">${escapeHtml(q.question || "")}</div>
          </div>`
          )
          .join("");
      }

    // ---------------------------
    // BOOTSTRAP
    // ---------------------------
    document.addEventListener("DOMContentLoaded", () => {
      renderStore();
      renderCart();
      renderPrivateQuestions();

      (function () {
        const widget = document.getElementById('unclePatWidget');
    const panel = document.getElementById('unclePatPanel');
    const closeBtn = document.getElementById('unclePatClose');
    const askBtn = document.getElementById('unclePatAskBtn');
    const subjectSelect = document.getElementById('unclePatSubject');
    const questionInput = document.getElementById('unclePatQuestion');
    const answerBox = document.getElementById('unclePatAnswer');
    const bigBear = document.getElementById('unclePatFull');

    if (!widget || !panel || !bigBear) return;

    // Show full bear + open panel
    widget.addEventListener('click', () => {
      widget.style.opacity = '0';
      bigBear.classList.add('show');

      setTimeout(() => {
        panel.classList.add('open');
      }, 350);
    });

    // Close panel + hide full bear + restore icon
    closeBtn.addEventListener('click', () => {
      panel.classList.remove('open');
      bigBear.classList.remove('show');

      setTimeout(() => {
        widget.style.opacity = '1';
      }, 200);
    });

    // Handle Ask Uncle Pat
    askBtn.addEventListener('click', () => {
      const subject = subjectSelect.value;
      const question = questionInput.value.trim();

      if (!question) {
        answerBox.innerHTML = "Try typing your question first, my curious friend üòä";
        return;
      }

      const reply = buildUnclePatAnswer(subject, question);
      answerBox.innerHTML = reply;
    });

    // Template-based answers
    function buildUnclePatAnswer(subject, question) {
      const safeQuestion = question.length > 160 ? question.slice(0, 157) + "..." : question;

      switch (subject) {
        case 'math':
          return `
            <strong>Hi there, math star! üåü</strong><br><br>
            You asked about: <em>${safeQuestion}</em>.<br><br>
            Here‚Äôs a simple way to think about it:<br>
            1) Understand what the numbers are asking you to do.<br>
            2) Break the problem into smaller steps.<br>
            3) Check your answer by going in the opposite direction.<br><br>
            Try it slowly on paper ‚Äì step by step. You‚Äôre doing great. üíö
          `;
        case 'english':
          return `
            <strong>Hello reading hero! üìñ</strong><br><br>
            You asked about: <em>${safeQuestion}</em>.<br><br>
            Read
             the sentence slowly, find who is doing the action (the noun) and what they are doing (the verb).<br>
            Underline any tricky words and try to say them in your own simple words.<br><br>
            Every time you read, your brain grows stronger. üå±
          `;
        case 'science':
          return `
            <strong>Hi little scientist! üî¨</strong><br><br>
            Your question: <em>${safeQuestion}</em> is a great science question.<br><br>
            Science starts when we notice something, ask ‚Äúwhy?‚Äù, and look for clues in the world around us.<br>
            Think about what you can see, touch, or measure about this topic ‚Äì that will help you understand it better.<br><br>
            Keep asking ‚Äúwhy‚Äù ‚Äì that‚Äôs how real scientists begin. üåü
          `;
        case 'bible':
          return `
            <strong>Hello, brave Bible thinker. ‚úùÔ∏è</strong><br><br>
            You asked: <em>${safeQuestion}</em>.<br><br>
            Some Bible questions feel big, and that‚Äôs okay. A good way to learn is to read the verse or story slowly, ask what it shows about God‚Äôs love, and talk about it with a safe grown-up who loves God too.<br><br>
            God loves curious kids and is not angry at your questions. üíö
          `;
        case 'feelings':
          return `
            <strong>Hi, big-hearted friend. üíõ</strong><br><br>
            You wrote about: <em>${safeQuestion}</em>.<br><br>
            Your feelings matter. It‚Äôs okay to feel sad, worried, or angry sometimes.<br>
            Try telling a safe adult you trust, putting your feeling into words (‚ÄúI feel _ because _‚Äù), and taking a few slow breaths.<br><br>
            You are not alone. Sharing your feelings is a very brave thing to do. üíö
          `;
        default:
          return `
            <strong>Hello, curious friend! üß†</strong><br><br>
            You asked: <em>${safeQuestion}</em>.<br><br>
            For many homework questions, a good pattern is:<br>
            1) Read the question twice slowly.<br>
            2) Underline the most important words.<br>
            3) Ask: ‚ÄúWhat is this really asking me to find or explain?‚Äù<br><br>
            Try your best first, then ask a safe adult if you still feel stuck.<br><br>
            I‚Äôm proud of you for not giving up. üåà
          `;
      }
      }
    })();
  });
</script>
 <!-- Uncle Pat corner widget (small icon) -->
<div class="uncle-pat-widget" id="unclePatWidget">
  <div class="uncle-pat-bear">
    <div class="uncle-pat-avatar">
      <img src="icons/uncle-pat-head.png" alt="Uncle Pat" />
    </div>
    <div class="uncle-pat-flag">
      Uncle Pat helps you<br>with your homework
    </div>
  </div>
</div>

<!-- Full-size Uncle Pat bear (hidden until clicked) -->


<!-- Uncle Pat Homework Helper Panel -->
<div class="uncle-pat-panel" id="unclePatPanel">
  <div class="uncle-pat-panel-inner">
    <div class="uncle-pat-panel-header">
      <span>Ask Uncle Pat</span>
      <button class="uncle-pat-panel-close" id="unclePatClose" aria-label="Close">‚úï</button>
    </div>

    <p class="uncle-pat-panel-sub">
      Stuck on something? Type your homework question below and Uncle Pat will give you a gentle explanation.
    </p>
<!-- Uncle Pat mascot inside panel -->
<div class="uncle-pat-panel-bear">
  <img src="icons/uncle-pat-full.png" alt="Uncle Pat mascot">
</div>
   
<label class="uncle-pat-label">
      Subject:
      <select id="unclePatSubject">
        <option value="general">General</option>
        <option value="math">Math</option>
        <option value="english">English</option>
        <option value="science">Science</option>
        <option value="bible">Bible</option>
        <option value="feelings">Feelings / Life</option>
      </select>
    </label>

    <label class="uncle-pat-label">
      Your question:
      <textarea id="unclePatQuestion" rows="3" placeholder="Write your question here..."></textarea>
    </label>

    <button class="uncle-pat-ask-btn" id="unclePatAskBtn">
      Ask Uncle Pat
    </button>

    <div class="uncle-pat-answer" id="unclePatAnswer"></div>
  </div>
</div>

  </body>
</html>